{% extends "base.html" %}
{% block content %}
<h2>Schedules</h2>
<form method="post">
  <label>Name <input type="text" name="name" required></label>
  <label>Role
    <select name="role_id">
    {% for r in roles %}<option value="{{ r.id }}">{{ r.name }}</option>{% endfor %}
    </select>
  </label>
  <label>Cadence
    <select name="cadence">
      <option value="daily">Daily (03:00)</option>
      <option value="weekly">Weekly (Sun 03:00)</option>
      <option value="interval">Interval (seconds)</option>
      <option value="cron">Cron (m h dom mon dow)</option>
    </select>
  </label>
  <label>Interval seconds <input type="number" name="interval" value="0"></label>
  <label>Cron expression <input type="text" name="cron" placeholder="0 3 * * *"></label>
  <label><input type="checkbox" name="notify"> Send notifications (SMTP/Slack/Teams if configured)</label>
  <h3>Select Hosts</h3>
  <div class="hostlist">
    {% for h in hosts %}
    <label><input type="checkbox" name="ips" value="{{ h.ip }}"> {{ h.ip }} — {{ h.hostname or '-' }} — {{ h.os_name or h.os_family or '-' }}</label><br/>
    {% endfor %}
  </div>
  <button type="submit">Create Schedule</button>
</form>

<h3>Existing Schedules</h3>
<table>
  <thead><tr><th>ID</th><th>Name</th><th>Role</th><th>Cadence</th><th>Enabled</th><th>Hosts</th><th>Actions</th></tr></thead>
  <tbody>
    {% for s in scheds %}
    <tr>
      <td>{{ s.id }}</td>
      <td>{{ s.name }}</td>
      <td>{{ s.role_name }}</td>
      <td>{{ s.cadence }} {% if s.cadence=='interval' %}({{ s.interval_seconds }}s){% elif s.cadence=='cron' %}({{ s.cron }}){% endif %}</td>
      <td>{{ 'Yes' if s.enabled else 'No' }}</td>
      <td>{{ (s.host_ips|length) if s.host_ips else 0 }}</td>
      <td>
        <form method="post" action="{{ url_for('ui.schedule_toggle', sid=s.id) }}">
          <button type="submit">{{ 'Disable' if s.enabled else 'Enable' }}</button>
        </form>
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}
